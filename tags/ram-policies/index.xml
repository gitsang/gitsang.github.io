<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>RAM Policies on Sang's Blog</title><link>https://gitsang.github.io/tags/ram-policies/</link><description>Recent content in RAM Policies on Sang's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 12 May 2025 10:40:43 +0800</lastBuildDate><atom:link href="https://gitsang.github.io/tags/ram-policies/index.xml" rel="self" type="application/rss+xml"/><item><title>RAM Permissions and Domain Management in Alibaba Cloud</title><link>https://gitsang.github.io/p/ram/</link><pubDate>Fri, 09 May 2025 19:17:31 +0800</pubDate><guid>https://gitsang.github.io/p/ram/</guid><description>&lt;!-- markdown-front-matter -->
&lt;h2 id="1-背景">&lt;a href="#1-%e8%83%8c%e6%99%af" class="header-anchor">&lt;/a>1. 背景
&lt;/h2>&lt;p>背景：&lt;/p>
&lt;ul>
&lt;li>假设只有一个二级域名 &lt;code>domain.com&lt;/code>，有多套环境的情况下，可能需要分配不同的三级子域名 &lt;code>sub.domain.com&lt;/code>，每个环境可能需要再配置四级子域名 &lt;code>sub.sub.domain.com&lt;/code>&lt;/li>
&lt;li>如果使用一个 AK 拥有所有域名的 DNS 权限，可能不太安全（即使互相信任，也无法避免误操作导致影响其他环境）&lt;/li>
&lt;/ul>
&lt;p>需求：&lt;/p>
&lt;ul>
&lt;li>每套环境需要拥有自己的一套 AK，并能自己管理自己的域名，互不冲突&lt;/li>
&lt;/ul>
&lt;h2 id="2-操作步骤">&lt;a href="#2-%e6%93%8d%e4%bd%9c%e6%ad%a5%e9%aa%a4" class="header-anchor">&lt;/a>2. 操作步骤
&lt;/h2>&lt;h3 id="21-添加子域名">&lt;a href="#21-%e6%b7%bb%e5%8a%a0%e5%ad%90%e5%9f%9f%e5%90%8d" class="header-anchor">&lt;/a>2.1 添加子域名
&lt;/h3>&lt;p>阿里云的 RAM 访问控制中，不允许使用通配等方式配置域名资源（因为操作是针对 AUTHORITY SECTION 的），因此必须先拆分出子域名。&lt;/p>
&lt;p>首先在 &lt;a class="link" href="https://dns.console.aliyun.com/" target="_blank" rel="noopener"
>域名解析&lt;/a> 页面添加子域名（本文以 &lt;code>env1.domain.com&lt;/code> 为例）&lt;/p>
&lt;p>&lt;img src="https://img2023.cnblogs.com/blog/2038910/202305/2038910-20230525094954695-265454889.png"
loading="lazy"
alt="image"
>&lt;/p>
&lt;p>添加域名需要 TXT 记录验证&lt;/p>
&lt;p>&lt;img src="https://img2023.cnblogs.com/blog/2038910/202305/2038910-20230525095051168-579963715.png"
loading="lazy"
alt="image"
>&lt;/p>
&lt;p>按照提示要求在你的主域名添加对应的 TXT 主机记录后点击验证即可添加成功。&lt;/p>
&lt;h3 id="22-创建子域名的-ram-权限策略">&lt;a href="#22-%e5%88%9b%e5%bb%ba%e5%ad%90%e5%9f%9f%e5%90%8d%e7%9a%84-ram-%e6%9d%83%e9%99%90%e7%ad%96%e7%95%a5" class="header-anchor">&lt;/a>2.2 创建子域名的 RAM 权限策略
&lt;/h3>&lt;p>其策略类似如下（需要把 &lt;code>${your-sub-domain}&lt;/code> 改为刚才创建的子域名，如本文的 &lt;code>env1.domain.com&lt;/code>），此处虽然可以使用通配，但名称必须是域名解析中列出的域名值。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;alidns:*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;acs:alidns:::domain/${your-sub-domain}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Action&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;alidns:Describe*&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;acs:alidns:::*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Allow&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里配置了两个策略：&lt;/p>
&lt;ul>
&lt;li>第一个策略是允许 &lt;code>acs:alidns:::domain/${your-sub-domain}&lt;/code> 资源的所有 &lt;code>alidns:*&lt;/code> 操作&lt;/li>
&lt;li>第二个策略是允许所有 &lt;code>acs:alidns:::*&lt;/code> 资源的 Describe &lt;code>alidns:Describe*&lt;/code> 操作（此处可能还需要 Describe 其他的资源，阿里云文档和客服并没有给出明确的答复）&lt;/li>
&lt;/ul>
&lt;h3 id="23-子账号赋权和-ak-申请">&lt;a href="#23-%e5%ad%90%e8%b4%a6%e5%8f%b7%e8%b5%8b%e6%9d%83%e5%92%8c-ak-%e7%94%b3%e8%af%b7" class="header-anchor">&lt;/a>2.3 子账号赋权和 AK 申请
&lt;/h3>&lt;p>新建一个 RAM 用户，需要勾选 &lt;code>OpenAPI 调用访问&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://img2023.cnblogs.com/blog/2038910/202305/2038910-20230525103254130-608849459.png"
loading="lazy"
alt="image"
>&lt;/p>
&lt;p>之后进入用户详情创建 AK&lt;/p>
&lt;p>&lt;img src="https://img2023.cnblogs.com/blog/2038910/202305/2038910-20230525103411240-349407655.png"
loading="lazy"
alt="image"
>&lt;/p>
&lt;p>进入权限管理为用户赋予刚才创建的策略，或者你也可以为用户组赋权后将用户加入用户组（推荐）&lt;/p>
&lt;p>&lt;img src="https://img2023.cnblogs.com/blog/2038910/202305/2038910-20230525104202528-918302234.png"
loading="lazy"
alt="image"
>&lt;/p>
&lt;h3 id="24-使用-ak">&lt;a href="#24-%e4%bd%bf%e7%94%a8-ak" class="header-anchor">&lt;/a>2.4 使用 AK
&lt;/h3>&lt;p>之后根据使用的不同的 ACME 或 DDNS 服务等的文档配置 AK 即可&lt;/p></description></item></channel></rss>