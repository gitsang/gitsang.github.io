<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>GatewayPorts on Sang's Blog</title><link>https://gitsang.github.io/tags/gatewayports/</link><description>Recent content in GatewayPorts on Sang's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 12 May 2025 10:44:44 +0800</lastBuildDate><atom:link href="https://gitsang.github.io/tags/gatewayports/index.xml" rel="self" type="application/rss+xml"/><item><title>Build SSH Tunnel</title><link>https://gitsang.github.io/p/build-ssh-tunnel/</link><pubDate>Sat, 14 Mar 2020 14:53:28 +0800</pubDate><guid>https://gitsang.github.io/p/build-ssh-tunnel/</guid><description>&lt;!-- markdown-front-matter -->
&lt;h2 id="1-使用场景">&lt;a href="#1-%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af" class="header-anchor">&lt;/a>1. 使用场景
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>机器代号&lt;/th>
&lt;th>操作系统&lt;/th>
&lt;th>机器位置&lt;/th>
&lt;th>IP&lt;/th>
&lt;th>账户名&lt;/th>
&lt;th>ssh/sshd 端口&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>OuterNet&lt;/td>
&lt;td>CentOS 7&lt;/td>
&lt;td>公网&lt;/td>
&lt;td>50.100.50.100&lt;/td>
&lt;td>OuterUser&lt;/td>
&lt;td>22&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>LocalNet&lt;/td>
&lt;td>CentOs 7&lt;/td>
&lt;td>内网(局域网)&lt;/td>
&lt;td>10.200.100.10&lt;/td>
&lt;td>LocalUser&lt;/td>
&lt;td>22&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>想要通过公网上的机器 OuterNet 访问内网机器 LocalNet&lt;/p>
&lt;p>并能够使用 OuterNet 机器的 10022 端口访问 LocalNet 机器的 22 端口&lt;/p>
&lt;p>相当于&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OuterUser@OuterNet&lt;span class="o">]&lt;/span> $ ssh -p &lt;span class="m">10022&lt;/span> LocalUser@127.0.0.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>替代在内网时候&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ ssh LocalUser@10.200.100.10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="11-建立简单的-ssh-反向隧道">&lt;a href="#11-%e5%bb%ba%e7%ab%8b%e7%ae%80%e5%8d%95%e7%9a%84-ssh-%e5%8f%8d%e5%90%91%e9%9a%a7%e9%81%93" class="header-anchor">&lt;/a>1.1 建立简单的 ssh 反向隧道
&lt;/h3>&lt;ol>
&lt;li>在 LocalNet 机器上执行以下命令建立隧道&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[LocalUser@LocalNet] $ ssh -p 22 -qngfNTR 10022:localhost:22 OuterUser@50.100.50.100
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或（以下参数似乎比较稳定）&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@LocalNet] $ ssh -fN -R :55555:localhost:22 50.100.50.100
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>在 OuterNet 上连接 LocalNet&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OuterUser@OuterNet&lt;span class="o">]&lt;/span> $ ssh -p &lt;span class="m">10022&lt;/span> LocalUser@127.0.0.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="12-维持隧道">&lt;a href="#12-%e7%bb%b4%e6%8c%81%e9%9a%a7%e9%81%93" class="header-anchor">&lt;/a>1.2 维持隧道
&lt;/h3>&lt;ol>
&lt;li>安装 autossh&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>LocalUser@LocalNet&lt;span class="o">]&lt;/span> $ sudo yum install autossh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>内网建立隧道&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>LocalUser@LocalNet&lt;span class="o">]&lt;/span> $ autossh -p &lt;span class="m">22&lt;/span> -M &lt;span class="m">7777&lt;/span> -NR 10022:localhost:22 OuterUser@50.100.50.100
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>在 OuterNet 上连接 LocalNet&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OuterUser@OuterNet&lt;span class="o">]&lt;/span> $ ssh -p &lt;span class="m">10022&lt;/span> LocalUser@127.0.0.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="13-监听-0000">&lt;a href="#13-%e7%9b%91%e5%90%ac-0000" class="header-anchor">&lt;/a>1.3 监听 0.0.0.0
&lt;/h3>&lt;p>如果需要监听 0.0.0.0 需要在服务端，即公网机器上开启 GatewayPorts&lt;/p>
&lt;p>在 /etc/ssh/sshd_config 中把 &lt;code>GatewayPorts&lt;/code> 设为 yes&lt;/p>
&lt;h2 id="2-参考">&lt;a href="#2-%e5%8f%82%e8%80%83" class="header-anchor">&lt;/a>2. 参考
&lt;/h2>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>&lt;a class="link" href="https://www.zsythink.net/archives/2450" target="_blank" rel="noopener"
>ssh 端口转发：ssh 隧道&lt;/a>&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item></channel></rss>